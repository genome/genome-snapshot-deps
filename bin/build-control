#!/usr/bin/env bash
set -o errexit
set -o pipefail

DISTRO=$1
if [ ! -d "$DISTRO" ]; then
    echo "Directory ($DISTRO) not found."
    exit 1
fi

function cat_deps {
    cat $1 | sed -r -e 's/^[\t ]*/\t/' -e 's/,?$/,/'
}

echo "Source: genome-snapshot-deps"
echo "Section: science"
echo "Priority: optional"
echo "Maintainer: The Genome Institute <gmt@genome.wustl.edu>"
case $DISTRO in
    lucid)
        echo "Build-Depends: debhelper (>= 7)"
        ;;
esac
echo "Standards-Version: 3.8.3"
echo ""
for PKG in $(cd $DISTRO && ls genome-snapshot-deps-*); do
    echo "Package: $PKG"
    echo "Architecture: all"
    case $PKG in
        genome-snapshot-apps-external)
            echo "Depends:"
            cat_deps "$DISTRO/$PKG"
            echo "Description: This meta-package installs all external app dependencies of the current internal TGI Genome Modeling System software snapshot."
            ;;
        genome-snapshot-deps-perl)
            echo "Depends: \${misc:Depends}, \${perl:Depends},"
            cat_deps "$DISTRO/$PKG"
            echo "Description: This meta-package installs all external Perl dependencies of the current internal TGI Genome Modeling System software snapshot."
            ;;
        genome-snapshot-deps-r)
            echo "Depends: \${misc:Depends},"
            cat_deps "$DISTRO/$PKG"
            echo "Description: This meta-package installs all external R dependencies of the current internal TGI Genome Modeling System software snapshot."
            ;;
    esac
    echo ""
done
echo "Package: genome-snapshot-deps"
echo "Architecture: all"
echo "Provides: genome"
echo "Depends: genome-snapshot-deps-perl (= \${source:Version}), genome-snapshot-deps-r (= \${source:Version}), genome-snapshot-apps-external (= \${source:Version})"
echo "Description: This meta-package installs all dependencies of the current TGI Genome Modeling System software snapshot."
