#!/usr/bin/env bash
set -o errexit
set -o pipefail

DISTRO=$1
if [ ! -d "$DISTRO" ]; then
    echo "Directory ($DISTRO) not found."
    exit 1
fi

function cat_deps {
    echo "Depends:"
    cat $1 | sed -r -e 's/^[\t ]*/\t/' -e 's/,?$/,/'
}

echo "Source: genome-snapshot-deps"
echo "Section: science"
echo "Priority: optional"
echo "Maintainer: The Genome Institute <gmt@genome.wustl.edu>"
case $DISTRO in
    lucid)
        echo "Build-Depends: debhelper (>= 7)"
        ;;
esac
echo "Standards-Version: 3.8.3"
echo ""
for PKG in $(cd $DISTRO && ls genome-snapshot-deps-*); do
    echo "Package: $PKG"
    echo "Architecture: all"
    cat_deps "$DISTRO/$PKG"
    case $PKG in
        genome-snapshot-deps-apps-tgi)
            echo "Description: This meta-package installs all internally developed apps and libraries which are dependencies of the current internal TGI Genome Modeling System software snapshot."
            ;;
        genome-snapshot-deps-apps-external)
            echo "Description: This meta-package installs all externally developed apps and libraries which are dependencies of the current internal TGI Genome Modeling System software snapshot."
            ;;
        genome-snapshot-deps-python)
            echo "Description: This meta-package installs all external Python dependencies of the current internal TGI Genome Modeling System software snapshot."
            ;;
        genome-snapshot-deps-perl)
            echo "Description: This meta-package installs all external Perl dependencies of the current internal TGI Genome Modeling System software snapshot."
            ;;
        genome-snapshot-deps-r)
            echo "Description: This meta-package installs all external R dependencies of the current internal TGI Genome Modeling System software snapshot."
            ;;
        genome-snapshot-deps-ur)
            echo "Description: This meta-package installs the UR dependencies. Eventually this should just be replaced with libur-perl."
            ;;
        genome-snapshot-deps-workflow)
            echo "Description: This meta-package installs the Workflow dependencies. Eventually this should just be replaced with libworkflow-perl."
            ;;
    esac
    echo ""
done
echo "Package: genome-snapshot-deps"
echo "Architecture: all"
echo "Provides: genome"
echo "Depends:"
for PKG in $(cd $DISTRO && ls genome-snapshot-deps-*); do
    echo "  $PKG (= \${source:Version}),"
done
echo "Description: This meta-package installs all dependencies of the current TGI Genome Modeling System software snapshot."

